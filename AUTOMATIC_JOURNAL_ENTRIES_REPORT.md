# تقرير شامل: القيود المحاسبية التلقائية في النظام

## 📋 نظرة عامة

النظام المحاسبي يحتوي على عدة أنواع من القيود التي تتولد تلقائياً عند تنفيذ عمليات معينة. هذا التقرير يوضح جميع هذه القيود بالتفصيل.

---

## 🔄 أنواع القيود التلقائية

### 1. **قيود الأصول الثابتة** 🏗️

#### أ) قيد شراء الأصل الثابت
**متى يتولد**: عند إنشاء أصل ثابت جديد بقيمة شراء > 0

**القيد المحاسبي**:
```
من حـ/ الأصل الثابت المحدد (1.2.X.Y)    XXX
    إلى حـ/ الصندوق/البنك (1.1.1.1)           XXX
```

**التفاصيل**:
- **رقم القيد**: `FA-{timestamp}-{random}`
- **الوصف**: `شراء أصل ثابت - {اسم الأصل}`
- **التاريخ**: تاريخ الشراء المحدد
- **الحسابات المنشأة تلقائياً**:
  - حساب الأصل الثابت المحدد
  - حساب مصروف الإهلاك
  - حساب مخصص الإهلاك

#### ب) قيود الإهلاك الدورية
**متى يتولد**: عند حساب الإهلاك الشهري/السنوي

**القيد المحاسبي**:
```
من حـ/ مصروف إهلاك {الأصل} (2.1.1.X)     XXX
    إلى حـ/ مخصص إهلاك {الأصل} (3.1.2.X)      XXX
```

---

### 2. **قيود الرواتب** 💰

#### أ) قيد استحقاق الراتب
**متى يتولد**: عند إنشاء قيد راتب جديد

**القيد المحاسبي**:
```
من حـ/ مصروف الرواتب (2.1.2.1)           XXX
    إلى حـ/ رواتب مستحقة الدفع (3.2.1.1)       XXX
```

#### ب) قيد دفع الراتب
**متى يتولد**: عند تغيير حالة الراتب إلى "مدفوع"

**القيد المحاسبي**:
```
من حـ/ رواتب مستحقة الدفع (3.2.1.1)       XXX
    إلى حـ/ الصندوق/البنك (1.1.1.1)           XXX
```

**التفاصيل**:
- **رقم القيد**: `PAY-{payrollId}`
- **الوصف**: `راتب {اسم الموظف} - {الشهر}/{السنة}`
- **المكونات**: الراتب الأساسي + البدلات + الإضافي + المكافآت - الخصومات

---

### 3. **قيود المبيعات** 🛒

#### أ) قيد فاتورة المبيعات
**متى يتولد**: عند إنشاء فاتورة مبيعات جديدة

**القيد المحاسبي**:
```
من حـ/ العملاء (1.1.3.X)                  XXX
    إلى حـ/ المبيعات (5.1.1.1)                XXX
    إلى حـ/ ضريبة القيمة المضافة (3.3.1.1)      XX (إن وجدت)
```

#### ب) قيد تحصيل من العميل
**متى يتولد**: عند تسجيل دفعة من العميل

**القيد المحاسبي**:
```
من حـ/ الصندوق/البنك (1.1.1.1)           XXX
    إلى حـ/ العملاء (1.1.3.X)                XXX
```

---

### 4. **قيود المشتريات** 📦

#### أ) قيد فاتورة المشتريات
**متى يتولد**: عند إنشاء فاتورة مشتريات جديدة

**القيد المحاسبي**:
```
من حـ/ المشتريات (2.2.1.1)               XXX
من حـ/ ضريبة القيمة المضافة (1.1.5.1)      XX (إن وجدت)
    إلى حـ/ الموردين (3.1.1.X)                XXX
```

#### ب) قيد دفع للمورد
**متى يتولد**: عند تسجيل دفعة للمورد

**القيد المحاسبي**:
```
من حـ/ الموردين (3.1.1.X)                XXX
    إلى حـ/ الصندوق/البنك (1.1.1.1)           XXX
```

---

### 5. **قيود الأرصدة الافتتاحية** 🎯

#### قيد الرصيد الافتتاحي
**متى يتولد**: عند إدخال الأرصدة الافتتاحية

**القيد المحاسبي**:
```
من حـ/ الحسابات ذات الطبيعة المدينة        XXX
    إلى حـ/ الحسابات ذات الطبيعة الدائنة        XXX
```

**التفاصيل**:
- **رقم القيد**: `OB-{timestamp}`
- **نوع القيد**: `Opening Balance`
- **الوصف**: `Opening Balance Entry`
- **التحقق**: يجب أن يتساوى مجموع المدين مع مجموع الدائن

---

### 6. **قيود السلف والمقدمات** 💳

#### أ) قيد منح السلفة
**متى يتولد**: عند إنشاء طلب سلفة جديد

**القيد المحاسبي**:
```
من حـ/ سلف الموظفين (1.1.4.X)            XXX
    إلى حـ/ الصندوق/البنك (1.1.1.1)           XXX
```

#### ب) قيد استرداد السلفة
**متى يتولد**: عند خصم السلفة من الراتب

**القيد المحاسبي**:
```
من حـ/ مصروف الرواتب (2.1.2.1)           XXX
    إلى حـ/ سلف الموظفين (1.1.4.X)            XXX
```

---

### 7. **قيود الشحن والنقل** 🚚

#### قيد فاتورة الشحن
**متى يتولد**: عند إنشاء فاتورة شحن جديدة

**القيد المحاسبي**:
```
من حـ/ العملاء (1.1.3.X)                  XXX
    إلى حـ/ إيرادات الشحن (5.2.1.1)            XXX
    إلى حـ/ إيرادات التخزين (5.2.2.1)          XX
    إلى حـ/ إيرادات التخليص (5.2.3.1)          XX
```

---

### 8. **قيود إنشاء الحسابات التلقائية** 🏗️

#### عند إنشاء عميل جديد
**متى يتولد**: عند إضافة عميل جديد

**الحسابات المنشأة**:
- حساب العميل تحت مجموعة العملاء (1.1.3.X)
- ربط تلقائي بين العميل والحساب

#### عند إنشاء مورد جديد
**متى يتولد**: عند إضافة مورد جديد

**الحسابات المنشأة**:
- حساب المورد تحت مجموعة الموردين (3.1.1.X)
- ربط تلقائي بين المورد والحساب

#### عند إنشاء موظف جديد
**متى يتولد**: عند إضافة موظف جديد

**الحسابات المنشأة**:
- حساب راتب الموظف تحت مجموعة الرواتب
- حساب سلف الموظف (اختياري)

---

## 🔧 آلية عمل القيود التلقائية

### 1. **التحقق من التوازن**
```javascript
const totalDebits = entries.reduce((sum, entry) => sum + (entry.debit || 0), 0);
const totalCredits = entries.reduce((sum, entry) => sum + (entry.credit || 0), 0);

if (Math.abs(totalDebits - totalCredits) > 0.01) {
  throw new Error('القيد غير متوازن: يجب أن يتساوى المدين مع الدائن');
}
```

### 2. **إنشاء رقم القيد التلقائي**
```javascript
// للأصول الثابتة
const entryNumber = `FA-${timestamp}-${randomSuffix}`;

// للرواتب
const entryNumber = `PAY-${payrollId}`;

// للأرصدة الافتتاحية
const entryNumber = `OB-${timestamp}`;
```

### 3. **ربط القيود بالمصادر**
- كل قيد مرتبط بالعملية التي أنشأته
- إمكانية تتبع القيد من مصدره
- حفظ معرف المستخدم الذي أنشأ القيد

---

## 📊 إحصائيات القيود التلقائية

### أنواع القيود حسب الأولوية:
1. **الأرصدة الافتتاحية** - أساسية لبدء النظام
2. **قيود الأصول الثابتة** - تنشأ عند إضافة أصول
3. **قيود الرواتب** - شهرية/دورية
4. **قيود المبيعات** - يومية حسب النشاط
5. **قيود المشتريات** - حسب الحاجة
6. **قيود السلف** - حسب الطلب
7. **قيود الشحن** - حسب نوع النشاط

### معدل التوليد:
- **يومياً**: قيود المبيعات والمشتريات
- **شهرياً**: قيود الرواتب والإهلاك
- **عند الحاجة**: قيود الأصول والسلف
- **مرة واحدة**: الأرصدة الافتتاحية

---

## ⚠️ ملاحظات مهمة

### 1. **التحقق من الحسابات**
- يجب وجود الحسابات المطلوبة قبل إنشاء القيود
- النظام ينشئ الحسابات تلقائياً عند الحاجة

### 2. **إدارة الأخطاء**
- جميع القيود تتم في transactions آمنة
- في حالة الخطأ، يتم التراجع عن جميع التغييرات

### 3. **الصلاحيات**
- قيود الأصول: تحتاج صلاحية مالية
- قيود الرواتب: تحتاج صلاحية مالية
- قيود المبيعات: تحتاج صلاحية مبيعات
- الأرصدة الافتتاحية: تحتاج صلاحية مالية عليا

### 4. **التدقيق والمراجعة**
- جميع القيود تحفظ معلومات المنشئ والتاريخ
- إمكانية تتبع مصدر كل قيد
- سجل كامل للتعديلات والحذف

---

## 🎯 الخلاصة

النظام يحتوي على **8 أنواع رئيسية** من القيود التلقائية تغطي جميع العمليات المحاسبية الأساسية. هذه القيود تضمن:

✅ **الدقة المحاسبية**: جميع القيود متوازنة تلقائياً
✅ **التوافق مع المعايير**: تطبيق مبدأ القيد المزدوج
✅ **الكفاءة**: توفير الوقت والجهد في الإدخال اليدوي
✅ **التتبع**: ربط كامل بين القيود ومصادرها
✅ **الأمان**: حماية من الأخطاء البشرية

النظام جاهز للاستخدام الفوري مع ضمان إنشاء جميع القيود المطلوبة تلقائياً! 🚀
