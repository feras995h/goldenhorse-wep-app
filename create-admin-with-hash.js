import pkg from 'pg';
const { Client } = pkg;

const client = new Client({
  connectionString: 'postgres://postgres:XIclgABy2kg3ZZ2Nyh7GOYexxcm206RTNsSAJavhbF4ukgMfDiNqXSOhy8SIALUP@72.60.92.146:5432/golden-horse-shipping'
});

async function createAdminWithHash() {
  try {
    await client.connect();
    console.log('ğŸ”§ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… admin Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù…Ø´ÙØ±Ø©...\n');

    // This is the hash for 'admin123' using bcrypt with salt rounds 12
    const admin123Hash = '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/4QjK.2a';
    
    // Update admin password with proper hash
    await client.query(`
      UPDATE users 
      SET password = $1, "updatedAt" = NOW()
      WHERE username = 'admin'
    `, [admin123Hash]);

    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± admin');
    console.log('ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123');
    console.log('ğŸ”‘ Ø§Ù„ØªØ´ÙÙŠØ±: $2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/4QjK.2a');

    // Verify the update
    const adminUser = await client.query(`
      SELECT username, password, "isActive"
      FROM users WHERE username = 'admin'
    `);

    if (adminUser.rows.length > 0) {
      const user = adminUser.rows[0];
      console.log(`\nğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.username}`);
      console.log(`ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù…Ø´ÙØ±Ø©): ${user.password}`);
      console.log(`âœ… Ù†Ø´Ø·: ${user.isActive ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}`);
    }

  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… admin:', error.message);
  } finally {
    await client.end();
  }
}

createAdminWithHash();
