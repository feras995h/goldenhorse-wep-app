# ุฏููู ุชูุธูู ูููุงุช ุงููุฌุฑุฉ (Migrations)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชุญุชูู ูุฌูุฏ `src/migrations` ุนูู **28 ููู ูุฌุฑุฉ** ุชุฑุงููุช ุฎูุงู ุชุทููุฑ ุงููุธุงู.  
ุจุนุฏ ุฅูุดุงุก ุณูุฑูุจุชุงุช SQL ุงููุจุงุดุฑุฉ (`create-all-tables.js` ูุบูุฑูุง)ุ ุฃุตุจุญุช ูุนุธู ูุฐู ุงููููุงุช **ุบูุฑ ุถุฑูุฑูุฉ**.

---

## ๐ ุฎุทูุงุช ุงูุชุญููู

### 1. ุชุดุบูู ุณูุฑูุจุช ุงูุชุญููู

```bash
cd server
node analyze-migrations.js
```

ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจู:
- โ ูุฑุงุกุฉ ุฌููุน ูููุงุช ุงููุฌุฑุฉ
- โ ููุงุฑูุชูุง ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
- โ ุชุตููููุง ุฅูู ูุฆุงุช (ูุฏููุฉุ ููุฑุฑุฉุ ุขููุฉ ููุญุฐูุ ูุฌุจ ุงูุงุญุชูุงุธ ุจูุง)
- โ ุฅูุดุงุก ุณูุฑูุจุชุงุช ุญุฐู ุชููุงุฆูุฉ

### 2. ูุญุต ุงููุชุงุฆุฌ

ุงูุณูุฑูุจุช ุณูุนุฑุถ:

#### โ ูููุงุช ูุฏููุฉ (Obsolete)
ูููุงุช ุชู ุงุณุชุจุฏุงููุง ุจุณูุฑูุจุชุงุช SQL ูุจุงุดุฑุฉ:
- `001-initial-schema.js`
- `001-updated-complete-schema.js`
- `002-additional-tables.js`
- `018-create-new-tables-only.js`

#### โ๏ธ ูููุงุช ููุฑุฑุฉ (Duplicates)
ูููุงุช ุจููุณ ุงููุธููุฉ:
- `002-add-performance-indexes.js`
- `008-add-performance-indexes.js`

#### ๐ก ูููุงุช ูุฏ ุชููู ุขููุฉ ููุญุฐู
ูููุงุช ุฅุถุงูุฉ ุฃุนูุฏุฉ (ุชู ุชุทุจูููุง):
- `002-add-missing-columns.js`
- `003-add-user-columns.js`
- `004-add-account-columns.js`
- `009-add-customer-missing-fields.js`
- ุฅูุฎ...

#### โ ูููุงุช ูุฌุจ ุงูุงุญุชูุงุธ ุจูุง
ุงููููุงุช ุงูุญุฏูุซุฉ ุฃู ุงููููุฉ:
- `20250115000001-create-invoice-payment.js`
- `20250115000002-create-invoice-receipt.js`
- `20250115000003-create-account-provision.js`
- ุฅูุฎ...

---

## ๐๏ธ ุฎุทูุงุช ุงูุญุฐู

### ุงูุทุฑููุฉ 1: ุญุฐู ุชููุงุฆู (Windows)

```powershell
# ุณูุชู ุฅูุดุงุก ูุฐุง ุงูุณูุฑูุจุช ุชููุงุฆูุงู
.\delete-old-migrations.ps1
```

### ุงูุทุฑููุฉ 2: ุญุฐู ุชููุงุฆู (Linux/Mac)

```bash
# ุณูุชู ุฅูุดุงุก ูุฐุง ุงูุณูุฑูุจุช ุชููุงุฆูุงู
chmod +x delete-old-migrations.sh
./delete-old-migrations.sh
```

### ุงูุทุฑููุฉ 3: ุญุฐู ูุฏูู

```bash
cd src/migrations

# ุญุฐู ุงููููุงุช ุงููุฏููุฉ
rm 001-initial-schema.js
rm 001-updated-complete-schema.js
rm 002-additional-tables.js
rm 002-add-performance-indexes.js
rm 002-create-notifications.js
rm 008-add-performance-indexes.js
rm 018-create-new-tables-only.js

# ุญุฐู ูููุงุช ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ (ุฅุฐุง ุชู ุชุทุจูููุง)
rm 002-add-missing-columns.js
rm 003-add-user-columns.js
rm 004-add-account-columns.js
rm 005-add-account-balance-columns.js
rm 006-add-account-description.js
rm 009-add-customer-missing-fields.js
rm 010-add-employee-missing-fields.js
rm 015-add-category-to-fixed-assets.js
rm 016-add-outstanding-amount-to-sales-invoices.js
rm 019-add-sales-tax-account-to-account-mappings.js

# ุญุฐู ุงูููู SQL
rm add-fixed-asset-accounts.sql
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงููุณุฎ ุงูุงุญุชูุงุทู
**ูุจู ุงูุญุฐู**ุ ูู ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ:

```bash
# ูุณุฎ ูุฌูุฏ migrations
cp -r src/migrations src/migrations_backup_$(date +%Y%m%d)

# ุฃู ุนูู Windows
xcopy src\migrations src\migrations_backup /E /I
```

### 2. ุฌุฏูู SequelizeMeta
ุจุนุฏ ุงูุญุฐูุ ูุฏ ุชุญุชุงุฌ ูุชูุธูู ุฌุฏูู `SequelizeMeta`:

```sql
-- ุนุฑุถ ุงูุณุฌูุงุช
SELECT * FROM "SequelizeMeta";

-- ุญุฐู ุงูุณุฌูุงุช ุงููุฏููุฉ (ุงุฎุชูุงุฑู)
DELETE FROM "SequelizeMeta" 
WHERE name LIKE '001-%' 
   OR name LIKE '002-%' 
   OR name LIKE '003-%';
```

### 3. ุงุณุชุฑุงุชูุฌูุฉ ุฌุฏูุฏุฉ
ุจุนุฏ ุงูุชูุธููุ ุงุณุชุฎุฏู:
- โ `create-all-tables.js` - ููุฅุนุฏุงุฏ ุงูุฃููู
- โ `add-missing-tables.js` - ูุฅุถุงูุฉ ุฌุฏุงูู ุฌุฏูุฏุฉ
- โ ุณูุฑูุจุชุงุช migrations ููุท ููุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ

---

## ๐ ุงูุชููุนุงุช

### ูุจู ุงูุชูุธูู:
- ๐ 28 ููู ูุฌุฑุฉ
- โ๏ธ ุชุนููุฏ ูู ุงูุตูุงูุฉ
- ๐ ุจุทุก ูู ุงูุงุฎุชุจุงุฑ

### ุจุนุฏ ุงูุชูุธูู:
- ๐ ~10-12 ููู ูุฌุฑุฉ
- โ ุณูููุฉ ูู ุงูุตูุงูุฉ
- โก ุณุฑุนุฉ ูู ุงูุงุฎุชุจุงุฑ

---

## โ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชุดุบูู `node analyze-migrations.js`
- [ ] ูุญุต ุงููุชุงุฆุฌ ูุงูุชุฃูุฏ
- [ ] ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุฌูุฏ migrations
- [ ] ุชุดุบูู ุณูุฑูุจุช ุงูุญุฐู
- [ ] ุงูุชุญูู ูู ุฃู ุงููุธุงู ูุนูู
- [ ] ุชูุธูู ุฌุฏูู SequelizeMeta (ุงุฎุชูุงุฑู)

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

**ููููู ุญุฐู 15-20 ููู ุจุฃูุงู**ุ ูุน ุงูุงุญุชูุงุธ ุจู:
1. ุงููููุงุช ุงูุชู ุชุจุฏุฃ ุจู `20250115` (ุญุฏูุซุฉ)
2. ูููุงุช ุฅูุดุงุก ุฌุฏุงูู ูููุฉ
3. ูููุงุช ุชุญุณููุงุช ุงูุฃุฏุงุก ุงูุญุฏูุซุฉ

---

*ุขุฎุฑ ุชุญุฏูุซ: 2025-10-05*
